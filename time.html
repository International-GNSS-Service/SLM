<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    <style>
       div.time-select {
            border: 1px solid rgba(0,0,0,0.2);
            background-color: white;
            box-shadow: 0 2px 10px 2px rgba(0,0,0,0.2);
            padding: 5px;
            position: absolute;
        }

        div.time-select > div::-webkit-scrollbar {
            display: none;
        }
        div.time-select > div {
            scrollbar-width: none;
        }

        div.time-select span {
            height: 40px;
            width: 55px;
            cursor: default;
            display: inline-block;
            text-align: center;
            line-height: 40px;
            font-size: 14px;
        }

        div.time-select span:hover {
            background-color: rgb(192, 214, 252);
        }

        div.time-select span.time-set {
            background-color: rgb(44, 120, 246);
            color: white;
            font-weight: bold;
        }

        span.time-selected {
            border: 2px solid black;
        }
    </style>
</head>
<body>
<div style="width: 80%; padding: 50px;">
    <form>
        <label for="time-builtin">Builtin</label>
        <input id="time-builtin" type="time" class="form-control">
        <br/>
        <label for="time24-1">24 Hr</label>
        <div>
            <div tabindex=0 style="display: flex; justify-content: space-between; align-items: center" class="time-24hr form-control">
                <span class="time"><span style="cursor: default; user-select: all;" class="hours">--</span>:<span style="cursor: default; user-select: all;" class="minutes">--</span></span>
                <div style="padding-right: 3px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-clock clock-icon" viewBox="-2 -2 20 20">
                        <path stroke="black" stroke-width="3%" d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                        <path stroke="black" stroke-width="3%" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                    </svg>
                </div>
                <input id='time24-1' class="time24-input" type="time" style="display: none">
            </div>
            <div class="time-select" tabindex="0" style="width: 130px; height: 250px; overflow-y: hidden; display: none; justify-content: space-evenly;">
                <div class="hour-scroll time-scroll" tabindex="0" style="width: 65px; overflow-y: scroll;">
                    <span class="time-set">00</span><span>01</span><span>02</span><span>03</span>
                    <span>04</span><span>05</span><span>06</span><span>07</span>
                    <span>08</span><span>09</span><span>10</span><span>11</span>
                    <span>12</span><span>13</span><span>14</span><span>15</span>
                    <span>16</span><span>17</span><span>18</span><span>19</span>
                    <span>20</span><span>21</span><span>22</span><span>23</span>
                </div>
                <div class="minute-scroll time-scroll" tabindex="0" style="width: 65px; overflow-y: scroll;">
                    <span class="time-set">00</span><span>01</span><span>02</span><span>03</span>
                    <span>04</span><span>05</span><span>06</span><span>07</span>
                    <span>08</span><span>09</span><span>10</span><span>11</span>
                    <span>12</span><span>13</span><span>14</span><span>15</span>
                    <span>16</span><span>17</span><span>18</span><span>19</span>
                    <span>20</span><span>21</span><span>22</span><span>23</span>
                    <span>24</span><span>25</span><span>26</span><span>27</span>
                    <span>28</span><span>29</span><span>30</span><span>31</span>
                    <span>32</span><span>33</span><span>34</span><span>35</span>
                    <span>36</span><span>37</span><span>38</span><span>39</span>
                    <span>40</span><span>41</span><span>42</span><span>43</span>
                    <span>44</span><span>45</span><span>46</span><span>47</span>
                    <span>48</span><span>49</span><span>50</span><span>51</span>
                    <span>52</span><span>53</span><span>54</span><span>55</span>
                    <span>56</span><span>57</span><span>58</span><span>59</span>
                </div>
            </div>
        </div>
        <br/>
    </form>
</div>

</body>
<script>

    $(document).ready(function() {
        const allTimeInputs = $('div.time-24hr');

        allTimeInputs.click(function() {
            const timeSelect = $(this).siblings('div.time-select');
            if (timeSelect.css('display') !== 'none') {
                toggleTimeSelectDropDown(timeSelect);
            }
        });

        allTimeInputs.keydown(function( event ) {
            let timeSelect = $(this).siblings('div.time-select');
            let selected = $(this).find('span.time-input-selected');
            let currentTime = timeSelect.find('span.time-selected');
            let isMinutes = selected.hasClass('minutes');
            if (event.which === 39 || event.which === 37) {
                // left/right
                if (!currentTime.length) {
                    if (selected.length > 0) {
                        selectSpanText(event.which === 39 ? selected.next() : selected.prev());
                    } else {
                        selectSpanText(timeSelect.find('span.hours'));
                    }
                } else {
                    if (currentTime.parent().hasClass('minute-scroll')) {
                        if (event.which === 37) {
                            selectTime(timeSelect.find('div.hour-scroll > span.time-set'));
                            selectSpanText($(this).find('span.hours'));
                        }
                    } else {
                        if (event.which === 39) {
                            selectTime(timeSelect.find('div.minute-scroll > span.time-set'));
                            selectSpanText($(this).find('span.minutes'));
                        }
                    }
                }
            } else if (event.which === 38 || event.which === 40) {
                // up/down
                if (!currentTime.length) {
                    currentTime = timeSelect.find(
                        `div.${ isMinutes ? "minute" : "hour"}-scroll > span.time-set`
                    );
                } else {
                    currentTime = event.which === 40 ? currentTime.next() : currentTime.prev();
                }
                selectTime(currentTime);
                selectSpanText(selected);
            } else if (event.which === 13) {
                // enter
                $(this).trigger("blur");
            } else if (event.which >= 48 && event.which <= 57) {
                // 0-9
                if (timeSelect.css('display') === 'none') {
                    let num = event.which - 48;
                    let numStr = num.toString();
                    let keyState = selected.data('keyState');
                    let max10s = isMinutes ? 5 : 2;
                    let max1s = isMinutes ? 9 : 3;
                    let skip;
                    let skipWrite = false;
                    if (!keyState) {
                        keyState = `0${numStr}`;
                        skip = num > max10s;
                    } else if (keyState.length >= 2) {
                        skipWrite = num > max1s && parseInt(keyState[1]) === max10s;
                        keyState = `${keyState[1]}${numStr}`;
                        skip = true;
                    }
                    if (!skipWrite) {
                        selected.data('keyState', keyState);
                        selected.html(keyState);
                        selectTime(timeSelect.find(
                            `div.${isMinutes ? "minute" : "hour"}-scroll > span:contains('${keyState}')`
                        ))
                    }
                    if (skip) {
                        if (isMinutes) {
                            $(this).trigger('blur');
                        } else {
                            selectSpanText($(this).find('span.minutes'));
                        }
                    } else {
                        selectSpanText(selected);
                    }
                }
            }
        });

        const toggleTimeSelectDropDown = function(timeSelect) {
            if (timeSelect.css('display') === 'none') {
                timeSelect.css('display', 'flex');
                initScroll(timeSelect);
            } else {
                timeSelect.css('display', 'none');
            }
        }
        $('div svg.clock-icon').click(function() {
            const timeInput = $(this).closest('.time-24hr');
            toggleTimeSelectDropDown(
                timeInput.siblings('.time-select')
            );
            timeInput.focus();
            return false;
        });

        $('div.hour-scroll > span').click(function(event) {
            selectTime($(this))
        });
        $('div.minute-scroll > span').click(function(event) {
            selectTime($(this));
        });

        allTimeInputs.blur(function(event) {
            if ($(event.relatedTarget).parents('div.time-select').length > 0) {
                $(this).focus();
                return false;
            }
            let selectDiv = $(this).siblings('div.time-select');
            selectDiv.css('display', 'none');
            selectDiv.find('span.time-selected').removeClass('time-selected');
            $(this).find('span.hours').data('keyState', null);
            $(this).find('span.minutes').data('keyState', null);
            $(this).find('span.time-input-selected').removeClass('time-input-selected');
            window.getSelection().removeAllRanges();
        });

        allTimeInputs.focusin(function(event) {
            selectSpanText($(this).find('span.hours'));
        });

        const selectSpanText = function(span) {
            if (!span.length) {
                return;
            }
            span.addClass('time-input-selected');
            span.siblings('span').removeClass('time-input-selected');
            let range, selection;
            if (window.getSelection && document.createRange) {
                selection = window.getSelection();
                range = document.createRange();
                range.selectNodeContents(span.get(0));
                selection.removeAllRanges();
                selection.addRange(range);
            } else if (document.selection && document.body.createTextRange) {
                range = document.body.createTextRange();
                range.moveToElementText(span.get(0));
                range.select();
            }
        }

        const initScroll = function(timeSelect) {
            const hourScroll = timeSelect.find('div.hour-scroll');
            setScroll(hourScroll, hourScroll.find('span.time-set'), true);
            const minuteScroll = timeSelect.find('div.minute-scroll');
            setScroll(minuteScroll, minuteScroll.find('span.time-set'), true);
        }

        const setScroll = function(scroll, span, top=false) {
            const selectTop = scroll.get(0).getBoundingClientRect().y;
            const selectBottom = selectTop + scroll.height();
            const spanTop = span.get(0).getBoundingClientRect().y;
            if (spanTop > (selectBottom - 5)) {
                scroll.get(0).scrollTop += (spanTop - selectBottom) + (top ? scroll.height() : span.height() + 5);
            } else if (spanTop < selectTop) {
                scroll.get(0).scrollTop -= selectTop - spanTop;
            }
        }

        const selectTime = function(timeSpan) {
            if (!timeSpan.length) { return; }
            const timeSelect = timeSpan.closest('div.time-select');
            const timeInput = timeSelect.siblings('div.time-24hr');
            const column = timeSpan.closest('div.time-scroll');
            timeSpan.siblings('span.time-set').removeClass('time-set');
            timeSpan.addClass('time-set');
            timeSelect.find('span.time-selected').removeClass('time-selected');
            timeSpan.addClass('time-selected');
            setScroll(column, timeSpan);
            setTime(timeInput, timeSelect);
        }

        const setTime = function(timeInput, timeSelect) {
            let hours = timeSelect.find('div.hour-scroll > span.time-set').text();
            let minutes = timeSelect.find('div.minute-scroll > span.time-set').text();
            timeInput.find('span.hours').html(hours);
            timeInput.find('span.minutes').html(minutes);
            if (hours !== null && minutes !== null) {
                timeInput.find('input[type="time"]').val(
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:00`
                );
            }
        }

        allTimeInputs.find('input[type="time"]').each(function() {
           let value = $(this).val().split(':');
           if (value[0]) {
               const timeSelect = $(this).closest('div.time-24hr').siblings('div.time-select');
               selectTime(timeSelect.find(`div.hour-scroll > span:contains('${value[0]}')`));
               selectTime(timeSelect.find(`div.minute-scroll > span:contains('${value[1]}')`));
           }
        });

    });

</script>
</html>
