<!-- 

Base Template

NOTES:
Base template extended into all other templates.
Allows for efficient preservation of key componenets. 

More info:
https://docs.djangoproject.com/en/3.2/topics/templates/

-->

{% load static compress %}

<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SLM 2.0 Beta</title>

    <link rel="shortcut icon" type="image/png" href="{% static 'slm/img/favicon.ico' %}"/>

    {% block stylesheets %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.3/font/bootstrap-icons.min.css" integrity="sha512-YzwGgFdO1NQw1CZkPoGyRkEnUTxPSbGWXvGiXrWk8IeSqdyci0dEDYdLLjMxq1zCoU0QBa4kHAFiRhUL3z2bow==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">

        {% compress css %}
            <link rel='stylesheet' type='text/css' media='screen' href='{% static "slm/css/style.css" %}'>
        {% endcompress %}
    {% endblock stylesheets %}


    {% block javascript %}
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

        {% compress js %}
            <script src="{% static 'slm/js/enums.js' %}"></script>
            <script src="{% static 'slm/js/slm.js' %}"></script>
            <script src="{% static 'slm/js/fileIcons.js' %}"></script>
            <script src="{% static 'slm/js/urls.js' %}"></script>
            <script>
                slm.isModerator = {% if is_moderator %}true{% else %}false{% endif %};
                slm.canPublish = {% if can_publish %}true{% else %}false{% endif %};
                $.ajaxSetup({
                    beforeSend: function (xhr)
                    {
                       xhr.setRequestHeader(
                           'X-CSRFToken', '{{ csrf_token }}');
                    }
                });
            </script>
        {% endcompress %}
    {% endblock javascript %}
    {% endblock head %}
</head>

<body>
  <!-- Top Navigation Menu -->
  <div id="top-bar">
    <nav class="navbar navbar-dark bg-igs-blue border-bottom border-dark navbar-expand-xl bg-faded justify-content-between">
      <div class="container-fluid mx-4">
        <div class="d-flex align-items-center w-50">
          <a href="{% url "slm:home" %}" class="navbar-brand"><img id="logo" class="me-4" src="{% static 'slm/img/slm-logo.svg' %}" alt="SLM"> Site Log Manager 2.0 Beta</a>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsingNavbar3" title="Navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        {% if user.is_authenticated %}
          {% block top_menu %}
            <!--
            Template for top menu bar
            -->
              <div class="navbar-collapse collapse w-100" id="collapsingNavbar">
                <ul class="navbar-nav w-100 justify-content-evenly">
                  {% include "slm/top_nav.html" with url_name=request.resolver_match.url_name %}
                </ul>
                <ul class="nav navbar-nav ms-auto w-100 justify-content-end">             
                  <li class="nav-item dropdown">
                    <a id="quick-help" class="nav-link help-popover" role="button" tabindex="0"  title="Legend">
                      Legend <i class="bi bi-info-circle ms-1"></i>
                    </a>
                    {% include "slm/widgets/legend.html" with url_name=request.resolver_match.url_name %}
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link" href="{% url 'slm:alerts' %}" aria-label="notifications">Alerts <i class="bi bi-bell{% if alert_level %}-fill text-{{ alert_level.bootstrap }}{% endif %} ms-1"></i></a>
                  </li>
                  <li class="nav-item dropdown">
                    <a id="user-dropdown" class="nav-link dropdown-toggle" href="#" id="navbarScrollingDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"> {% if user.name %}{{ user.name }}{% else %}{{ user.email }}{% endif %} </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <!-- User Drop Down -->
                      {% if request.user.is_superuser %}
                      <li><a class="dropdown-item" href="{% url "admin:index" %}">Admin</a></li>
                      <li>
                        <hr class="dropdown-divider">
                      </li>
                      {% endif %}
                      <li><a class="dropdown-item" href="{% url "slm:profile" %}">Profile</a></li>
                      <li><a class="dropdown-item" href="{% url "account_change_password" %}">Change Password</a></li>
                      <li><a class="dropdown-item" href="{% url "slm:user_activity" %}">Activity Log</a></li>
                      <li>
                        <hr class="dropdown-divider">
                      </li>
                      <li><a class="dropdown-item" href="{% url "account_logout" %}">Logout</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
          {% endblock %}
        {% endif %}
      </div>
    </nav>
  </div>

  {% block login_content %}{% endblock %}

  {% block page_content %}{% endblock %}

  <div id="footer" class="container-fluid bg-igs-blue">
    <footer class="d-flex flex-wrap justify-content-end align-items-center py-2 border-top">
      <div class="col-md-4 d-flex align-items-center justify-content-end pe-4">
        <a href="/" class="mb-3 me-2 mb-md-0">
          <a href="{% url "slm:home" %}" class="navbar-brand"><img id="footer-logo" src="{% static 'slm/img/slm-logo.svg' %}" alt="SLM">
        </a>
          <span class="mb-3 mb-md-0 text-light"><a href="https://igs.org" target="_blank" style="color: whitesmoke; text-decoration: none">Powered by International GNSS Service</a></span>
      </div>
    </footer>
  </div>

  {% compress js %}
  <script type='text/javascript'>
    $(document).ready(function() {
      var options = {
        html: true,
        content: $('[data-name="quick-help-info"]')
      }
      var helpPopover = document.getElementById('quick-help')
      var popover = new bootstrap.Popover(
          document.querySelector('.help-popover'), {
        container: 'body',
        html: true,
        content: document.getElementById('quick-help-info'),
      })
    })
  </script>
  {% endcompress %}
</html>